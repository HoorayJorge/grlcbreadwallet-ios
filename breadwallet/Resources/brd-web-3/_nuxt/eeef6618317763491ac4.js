(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{450:function(e,t,r){"use strict";r.r(t);var n=r(3),a=r.n(n),i=(r(57),r(12),r(1)),u=r.n(i),s=r(24),o=r(136),c=r(14),p=(r(11),r(2));t.default={mixins:[o.default],data:function(){return{token:null,type:"widget",kycState:null,configurationSteps:[{name:"Register",endpoint:"register",flow:"CoinifyRegister",setupOnly:!0}],estimatedDelivery:"4-6 days",slug:"coinify"}},computed:{readyToUse:function(){return!!this.token}},watch:{token:function(){this.token&&this.$kv.set("coinifyServiceToken",this.token)}},methods:{initialize:function(){var e=u()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$kv.get("coinifyServiceToken");case 2:this.token=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),fetchKYCState:function(){var e=u()(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.rpc("coinify/kyc",{serviceToken:this.token});case 2:if(t=e.sent,r=t.result,!(n=t.error)){e.next=8;break}return console.error("Error getting Coinify KYC state: ",n),e.abrupt("return",{error:n});case 8:return this.kycState=r,"error"!==(a=r.state)&&this.$store.dispatch("exchange/updateMeta",{"services.coinify.kyc.state":a}),e.abrupt("return",{result:r});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),fetchDetailLink:function(){var e=u()(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.rpc("coinify/trade_details",{serviceToken:this.token,tradeId:t});case 2:if(r=e.sent,n=r.result,!(a=r.error)){e.next=8;break}return console.error("Error getting trade_details: ",a),e.abrupt("return",{error:a});case 8:return e.abrupt("return",{result:n});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),nextStep:function(){if(!this.token)return 0},limits:function(){return null},titleFor:function(e){var t=e&&e.medium;return this.$t("exchange.coinify.title.".concat(t))},typeFor:function(e){var t=e.medium;return this.$t("exchange.coinify.type.".concat(t))},limitsStringFor:function(e){var t=e&&e.medium;return this.$t("exchange.coinify.limits.".concat(t))},history:function(){var e=u()(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.rpc("coinify/history",{serviceToken:this.token});case 2:if(t=e.sent,r=t.error,n=t.result,!r){e.next=7;break}throw r;case 7:if(n){e.next=9;break}throw new Error("coinify/history:no-result");case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),quote:function(){var e=u()(regeneratorRuntime.mark(function e(t){var r,n,a,i,u,o,p,f,l,h,m,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{});case 2:if(r=t.amount,n=t.to,a=t.from,i=t.mode,u=t.paymentMethod,o={amount:r,mode:i,paymentMethod:u,medium:t.medium,to:n&&n.toUpperCase(),from:a&&a.toUpperCase(),serviceToken:this.token,network:this.network},"buy"==t.mode){e.next=9;break}return e.next=7,Object(c.e)(a);case 7:(p=e.sent).error||(o.address=p);case 9:if("sell"==t.mode){e.next=18;break}return e.next=12,Object(c.e)(n);case 12:if((f=e.sent).error){e.next=17;break}o.address=f,e.next=18;break;case 17:return e.abrupt("return",{error:f.error});case 18:return e.next=20,s.a.rpc("coinify/quote",o);case 20:if(l=e.sent,h=l.result,!(m=l.error)){e.next=25;break}return e.abrupt("return",{error:m});case 25:return!h.meta||"lineItems"in h.meta||(d=h.meta,h.meta.lineItems=[{label:"buy.quote.payment-method",valueSlug:"exchange.title.sepa"},{label:"buy.quote.delivery",valueText:"4-6 day"},{label:"buy.quote.subtotal",value:d.subtotal},{label:"buy.quote.fee",value:d.fee},{label:"buy.quote.total",value:d.from}]),e.abrupt("return",{result:h});case 27:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),tradeStatus:function(){var e=u()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.a.rpc("coinify/trade_status",{serviceToken:this.token,tradeId:Number(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),execute:function(){var e=u()(regeneratorRuntime.mark(function e(t){var r,n,i,u,o,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.execute,console.log("EXECUTE: ",r),e.next=4,this.prepareExecutionHash(r.params,r.schema);case 4:return n=e.sent,console.log("RES: ",n),e.next=8,s.a.rpc("coinify/execute",a()({},n,{serviceToken:this.token}));case 8:if(i=e.sent,u=i.result,!(o=i.error)){e.next=13;break}return e.abrupt("return",{error:o});case 13:if("browser-url"!=(f=u.action||u).type){e.next=19;break}return e.next=17,Object(c.b)(f);case 17:e.next=20;break;case 19:throw new Error("Unknown result type: ",f.type||f);case 20:return this.$store.dispatch("exchange/updateMeta",{"services.coinify.lastTxId":u.transaction.id}),e.next=23,this.tradeStatus(u.transaction.id);case 23:if(l=e.sent,"awaiting_transfer_in"!=Object(p.g)(l,"result.transaction.state")||"card"!=Object(p.g)(l,"result.transaction.style")){e.next=26;break}return e.abrupt("return",{result:{meta:{screen:{screenType:"error",title:"Order Incomplete",message:"Don't worry, it happens sometimes. Double check your credit/debit card info and try again.",userActions:[f]}}}});case 26:if(!l.error){e.next=28;break}return e.abrupt("return",{result:u});case 28:return e.abrupt("return",{result:a()({},l.result,{delivery:u.delivery,detailsUrl:u.detailsUrl})});case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}}}}]);
//# sourceMappingURL=eeef6618317763491ac4.js.map